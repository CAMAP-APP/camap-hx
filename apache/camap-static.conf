# apache/camap-static.conf

# env.js généré par entrypoint (local, no-cache)
Alias /env.js "/srv/www/env.js"
<Files "/srv/www/env.js">
  Require all granted
  AddType application/javascript .js
  Header set Cache-Control "no-store, must-revalidate"
  Header set Pragma "no-cache"
</Files>

# Les bundles front sont servis par camap-ts (nest-devcamap) sous /neostatic
ProxyPass        /neostatic/ http://nest-devcamap:3010/neostatic/
ProxyPassReverse /neostatic/ http://nest-devcamap:3010/neostatic/

## API GraphQL (fallback relatif utilisé par le front)
ProxyPass        /graphql http://nest-devcamap:3010/graphql
ProxyPassReverse /graphql http://nest-devcamap:3010/graphql

## Locales i18n (traductions)
ProxyPass        /locales/ http://nest-devcamap:3010/locales/
ProxyPassReverse /locales/ http://nest-devcamap:3010/locales/

# Bypass complet de mod_neko/rewrites pour ces chemins
RewriteEngine On
RewriteCond %{REQUEST_URI} ^/neostatic/ [OR]
RewriteCond %{REQUEST_URI} ^/env.js$     [OR]
RewriteCond %{REQUEST_URI} ^/graphql$    [OR]
RewriteCond %{REQUEST_URI} ^/locales/
RewriteRule ^ - [L]

<LocationMatch "^/(neostatic/|env\.js$|graphql|locales/)">
  SetHandler none
</LocationMatch>
